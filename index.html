
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenQASM Live Specification documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="openqasm-live-specification">
<h1>OpenQASM Live Specification<a class="headerlink" href="#openqasm-live-specification" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-intro"></span><div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>OpenQASM is an imperative programming language for describing quantum circuits. It is capable to
describe universal quantum computing using the circuit model, measurement-based model, and near-term
quantum computing experiments. It achieves this using a parameterized set of physical logic gates
and concurrent real-time classical computations. Its main goal is to serve as an intermediate
representation for higher-level compilers to communicate with quantum hardware; however, allowances
have been made to make it pleasant to write for people as well. In particular, the language admits
different representations of the same program as it is lowered from a high-level description down to
a low-level pulse representation.</p>
<p>This document is draft version 3.0 of the OpenQASM specification. The Qiskit development team is
soliciting feedback on this draft for consideration prior to finalizing version 3.0.</p>
<div class="section" id="design-goals">
<h3>Design Goals<a class="headerlink" href="#design-goals" title="Permalink to this headline">¶</a></h3>
<p>Version 3.0 of the OpenQASM specification aims to extend OpenQASM to include:</p>
<ul class="simple">
<li><p><strong>A broader family of computation with classical logic</strong>. We introduce classical control flow,
instructions, and data types to define circuits that include real-time computations on
classical data. A <em>kernel</em> mechanism allows for opaque references to generic classical
computations acting upon run-time data.</p></li>
<li><p><strong>Explicit timing</strong>. We introduce a flexible mechanism to describe <em>design intent</em> of
instruction scheduling while remaining independent of specific durations determined by gate
calibrations. This enables, for example, dynamical decoupling while retaining a gate-level
description of a circuit.</p></li>
<li><p><strong>Embedded pulse-level definitions</strong>. An extensible mechanism to attach low-level definitions to
gates. This is particularly relevant to calibration tasks which optimize pulse parameters using
error amplification sequences most easily described at the gate level.</p></li>
</ul>
</div>
<div class="section" id="scope">
<h3>Scope<a class="headerlink" href="#scope" title="Permalink to this headline">¶</a></h3>
<p>This document aims to define the OpenQASM language itself, but it does not attempt to fully explain
the motivation for various design choices. A forthcoming paper will provide this background. This
document also does not seek to define the execution environment that accepts OpenQASM as an input.
For the previous versions of OpenQASM please read <a class="reference external" href="https://arxiv.org/abs/1707.03429">arXiv:1707.03429</a>.</p>
</div>
</div>
<span id="document-language/index"></span><div class="section" id="language">
<span id="sec-spec"></span><h2>Language<a class="headerlink" href="#language" title="Permalink to this headline">¶</a></h2>
<p>Hereafter, OpenQASM refers to the extended language we now describe. The
human-readable form of OpenQASM is a simple C-like textual language.
Statements are separated by semicolons. Whitespace is ignored. The
language is case sensitive. Appendix <a class="reference external" href="#app:summary">[app:summary]</a>
summarizes the language statements,
Appendix <a class="reference external" href="#app:grammar">[app:grammar]</a> specifies the grammar, and
Appendix <a class="reference external" href="#app:semantics">[app:semantics]</a> gives formal semantics.</p>
<div class="toctree-wrapper compound">
<span id="document-language/comments"></span><div class="section" id="comments">
<h3>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h3>
<p>Comments begin with a pair of forward slashes and end with a new line:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// A comment line</span>
</pre></div>
</div>
<p>A comment block begins with <code class="docutils literal notranslate"><span class="pre">/*</span></code> and ends with <code class="docutils literal notranslate"><span class="pre">*/</span></code>:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">A comment block</span>
<span class="cm">*/</span>
</pre></div>
</div>
</div>
<div class="section" id="version-string">
<h3>Version string<a class="headerlink" href="#version-string" title="Permalink to this headline">¶</a></h3>
<p>The first (non-comment) line of an OpenQASM program may optionally be
indicating a major version M and minor version m. Version 3.0 is
described in this document. Multiple occurrences of the version keyword
are not permitted. The minor version number and decimal point are
optional. If they are not present, they are assumed to be zero.</p>
</div>
<div class="section" id="included-files">
<h3>Included files<a class="headerlink" href="#included-files" title="Permalink to this headline">¶</a></h3>
<p>The statement continues parsing as if the contents of the file were
inserted at the location of the statement.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// First non-comment is a version string</span>
<span class="n">OPENQASM</span> <span class="mf">3.0</span><span class="p">;</span>

<span class="cp">#include</span> <span class="cpf">&quot;stdgates.qasm&quot;</span><span class="c1">;</span><span class="cp"></span>

<span class="c1">// Rest of QASM program</span>
</pre></div>
</div>
</div>
<span id="document-language/types"></span><div class="section" id="types-and-casting">
<h3>Types and Casting<a class="headerlink" href="#types-and-casting" title="Permalink to this headline">¶</a></h3>
<div class="section" id="generalities">
<h4>Generalities<a class="headerlink" href="#generalities" title="Permalink to this headline">¶</a></h4>
<p>Variable identifiers must begin with a letter [A-Za-z], an underscore, a
percent sign, or an element from the Unicode character categories
Lu/Ll/Lt/Lm/Lo/NI <span class="bibtex" id="id1">[noauthorUnicodeNodate]</span>.
Continuation characters may contain numbers. Variable identifiers may
not override a reserved identifier. All qubits are global variables.
When qubits are declared, their state is initially undefined. Qubits
cannot be declared within gates or subroutines. This simplifies OpenQASM
significantly since there is no need for quantum memory management.
However, it also means that users or compiler have to explicitly manage
the quantum memory. In addition to being assigned values within a
program, all of the classical types can be initialized on declaration.
Multiple comma-separated declarations can occur after the typename with
optional assignment on declaration for each. Any classical variable or
Boolean that is not explicitly initialized is undefined. Classical types
can be mutually cast to one another using the typename . We use the
notation to denote the width and precision of fixed point numbers, where
is the number of sign bits, is the number of integer bits, and is the
number of fractional bits. It is necessary to specify low-level
classical representations since OpenQASM operates at the intersection of
gates/analog control and digital feedback and we need to be able to
explicitly transform types to cross these boundaries. Classical types
are scoped to the braces within which they are declared.</p>
</div>
<div class="section" id="quantum-types">
<h4>Quantum types<a class="headerlink" href="#quantum-types" title="Permalink to this headline">¶</a></h4>
<div class="section" id="qubits">
<h5>Qubits<a class="headerlink" href="#qubits" title="Permalink to this headline">¶</a></h5>
<p>There is a quantum bit () type that is interpreted as a reference to a
two-level subsystem of a quantum state. Quantum registers are static
arrays of qubits that cannot be dynamically resized. The statement
declares a reference to a quantum bit. The statement or declares a
quantum register with the given name identifier. The keyword is included
for backwards compatibility and will be removed in the future. Sizes
must always be constant positive integers. The label refers to a qubit
of this register, where
<span class="math notranslate nohighlight">\(j\in \{0,1,\dots,\mathrm{size}(\mathrm{name})-1\}\)</span> is an integer.
Qubits are initially in an undefined state. A quantum operation is one
way to initialize qubit states.</p>
</div>
<div class="section" id="physical-qubits">
<h5>Physical Qubits<a class="headerlink" href="#physical-qubits" title="Permalink to this headline">¶</a></h5>
<p>While program qubits can be named, hardware qubits are referenced only
by integers with the syntax <code class="docutils literal notranslate"><span class="pre">%0</span></code>, <code class="docutils literal notranslate"><span class="pre">%1</span></code>, …, <code class="docutils literal notranslate"><span class="pre">%n</span></code>. These qubit types are
used in lower parts of the compilation stack when emitting physical
circuits.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>// Declare a qubit
qubit gamma;
// Declare a qubit with a Unicode name
qubit γ;
// Declare a qubit array with 20 qubits
qubit qubit_array[20];
// Declare usage of physical qubit 0
qubit %0;
</pre></div>
</div>
</div>
</div>
<div class="section" id="classical-types">
<h4>Classical types<a class="headerlink" href="#classical-types" title="Permalink to this headline">¶</a></h4>
<div class="section" id="classical-bits-and-registers">
<h5>Classical bits and registers<a class="headerlink" href="#classical-bits-and-registers" title="Permalink to this headline">¶</a></h5>
<p>There is a classical bit type that takes values 0 or 1. Classical
registers are static arrays of bits. The classical registers model part
of the controller state that is exposed within the OpenQASM program. The
statement declares a classical bit, and or declares an array of bits
(register). The keyword is deprecated and will be removed in the future.
The label refers to a bit of this register, where <span class="math notranslate nohighlight">\(j\in
\{0,1,\dots,\mathrm{size}(\mathrm{name})-1\}\)</span> is an integer. For
convenience, classical registers can be assigned a text string
containing zeros and ones of the same length as the size of the
register. It is interpreted to assign each bit of the register to
corresponding value 0 or 1 in the string, where the least-significant
bit is on the right.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Declare an array of 20 bits</span>
<span class="n">bit</span> <span class="n">bit_array</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span>
<span class="c1">// Declare and assign an array of bits with decimal value of 15</span>
<span class="n">bit</span> <span class="n">name</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;00001111&quot;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="integers">
<h5>Integers<a class="headerlink" href="#integers" title="Permalink to this headline">¶</a></h5>
<p>There are n-bit signed and unsigned integers. The statements and declare
signed 1:n-1:0 and unsigned 0:n:0 integers of the given size. The sizes
are always explicitly part of the type; there is no implicit width for
classical types in OpenQASM. Because register indices are integers, they
can be cast from classical registers containing measurement outcomes and
may only be known at run time. An n-bit classical register containing
bits can also be reinterpreted as an integer, and these types can be
mutually cast to one another using the type name, e.g. . As noted, this
conversion will be done assuming little-endian bit ordering.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Declare a 32-bit unsigned integer</span>
<span class="n">uint</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">my_uint</span><span class="p">;</span>
<span class="c1">// Declare a 32 bit signed integer</span>
<span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">my_int</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="signed-fixed-point-numbers">
<h5>Signed fixed-point numbers<a class="headerlink" href="#signed-fixed-point-numbers" title="Permalink to this headline">¶</a></h5>
<p>There are fixed-point numbers with integer bits, fractional bits, and 1
sign bit. The statement declares a fixed-point number.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Declare a 32-bit fixed point number.</span>
<span class="c1">// The number is signed, has 7 integer bits</span>
<span class="c1">// and 24 fractional bits.</span>
<span class="n">fixed</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span> <span class="n">my_fixed</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="floating-point-numbers">
<h5>Floating point numbers<a class="headerlink" href="#floating-point-numbers" title="Permalink to this headline">¶</a></h5>
<p>IEEE 754 floating point registers may be declared with , where would
indicate a standard double-precision float. Note that some hardware
vendors may not support manipulating these values at run-time.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>// Declare a single-precision 32-bit float
float[32] my_float = π;
</pre></div>
</div>
</div>
<div class="section" id="fixed-point-angles">
<h5>Fixed-point angles<a class="headerlink" href="#fixed-point-angles" title="Permalink to this headline">¶</a></h5>
<p>Fixed-point angles are interpreted as <span class="math notranslate nohighlight">\(2\pi\)</span> times a 0:1:n-1
fixed-point number. This represents angles in the interval
<span class="math notranslate nohighlight">\([0,2\pi)\)</span> up to an error <span class="math notranslate nohighlight">\(\epsilon\leq \pi/2^{n-1}\)</span> modulo
<span class="math notranslate nohighlight">\(2\pi\)</span>. The statement declares an n-bit angle. OpenQASM3
introduces this specialized type because of the ubiquity of this angle
representation in phase estimation circuits and numerically controlled
oscillators found in hardware platform. Note that defining gate
parameters with types may be necessary for those parameters to be
compatible with run-time values on some platforms.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Declare an angle with 20 bits of precision</span>
<span class="n">angle</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="n">my_angle</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="boolean-types">
<h5>Boolean types<a class="headerlink" href="#boolean-types" title="Permalink to this headline">¶</a></h5>
<p>There is a Boolean type that takes values or . Qubit measurement results
can be converted from a classical type to a Boolean using , where 1 will
be true and 0 will be false.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">bit</span> <span class="n">my_bit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">bool</span> <span class="n">my_bool</span><span class="p">;</span>
<span class="c1">// Assign a cast bit to a boolean</span>
<span class="n">my_bool</span> <span class="o">=</span> <span class="kt">bool</span><span class="p">(</span><span class="n">my_bit</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="real-constants">
<h5>Real constants<a class="headerlink" href="#real-constants" title="Permalink to this headline">¶</a></h5>
<p>To support mathematical expressions, there are immutable real constants
that are represented as double precision floating point numbers. On
declaration, they take their assigned value and cannot be redefined
within the same scope. These are constructed using an in-fix notation
and scientific calculator features such as scientific notation, real
arithmetic, logarithmic, trigonometric, and exponential functions
including , , , , , , and the built-in constant <span class="math notranslate nohighlight">\(\pi\)</span>. The
statement defines a new constant. The expression on the right hand side
has a similar syntax as OpenQASM 2 parameter expressions; however,
previously defined constants can be referenced in later variable
declarations. Real constants are compile-time constants, allowing the
compiler to do constant folding and other such optimizations. Scientific
calculator-like operations on run-time values require kernel function
calls as described later and are not available by default. Real
constants can be cast to other types. Casting attempts to preserve the
semantics, but information can be lost, since variables have fixed
precision. Unlike casting from other types, implicit casts from real
constants are permitted.</p>
<p>A standard set of built-in constants which are included in the default
namespace are listed in table <a class="reference external" href="#tab:real-constants">1</a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>// Declare a constant
const my_const = 1234;
// Scientific notation is supported
const another_const = 1e2;
// Constant expressions are supported
const pi_by_2 = π / 2;
// Constants may be cast to real-time values
float[32] pi_by_2_val = float(pi_by_2)
</pre></div>
</div>
<div class="docutils container" id="tab-real-constants">
<table class="docutils align-default" id="id2">
<caption><span class="caption-number">Table 1 </span><span class="caption-text">[tab:real-constants] Built-in real constants in OpenQASM3.</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 39%" />
<col style="width: 18%" />
<col style="width: 18%" />
<col style="width: 26%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Constant</p></td>
<td><p>Alphanumeric</p></td>
<td><p>Unicode</p></td>
<td><p>Approximate Base 10</p></td>
</tr>
<tr class="row-even"><td><p>(r)1-1(lr)2-2(rl)3-3(l)4-4 Pi</p></td>
<td><p>pi</p></td>
<td><p><span class="math notranslate nohighlight">\(\pi\)</span></p></td>
<td><p>3.1415926535…</p></td>
</tr>
<tr class="row-odd"><td><p>Tau</p></td>
<td><p>tau</p></td>
<td><p><span class="math notranslate nohighlight">\(\tau\)</span></p></td>
<td><p>6.283185…</p></td>
</tr>
<tr class="row-even"><td><p>Euler’s number</p></td>
<td><p>euler_gamma</p></td>
<td><p><span class="math notranslate nohighlight">\(e\)</span></p></td>
<td><p>2.7182818284…</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="types-related-to-timing">
<h4>Types related to timing<a class="headerlink" href="#types-related-to-timing" title="Permalink to this headline">¶</a></h4>
<div class="section" id="length">
<h5>length<a class="headerlink" href="#length" title="Permalink to this headline">¶</a></h5>
<p>We introduce a type and several keywords to express lengths of time.
Lengths are positive numbers with a unit of time. are used for SI time
units. is a backend-dependent unit equivalent to one waveform sample on
the backend. is an intrinsic function used to reference the duration of
another part of the program or the duration of a calibrated gate.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">length</span> <span class="n">one_second</span> <span class="o">=</span> <span class="mi">1000</span><span class="n">ms</span><span class="p">;</span>
<span class="n">length</span> <span class="n">thousand_cycles</span> <span class="o">=</span> <span class="mi">1000</span><span class="n">dt</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="stretch">
<h5>stretch<a class="headerlink" href="#stretch" title="Permalink to this headline">¶</a></h5>
<p>We further introduce a type which is a sub-type of . Stretchable lengths
have variable non-negative length that is permitted to grow as necessary
to satisfy constraints. Stretch variables are resolved at compile time
into target-appropriate durations that satisfy a user’s specified design
intent. We distinguish different “orders” of stretch via types, where N
is an integer between 0 to 255. is an alias for the regular . At the
timing resolution stage of the compiler, higher order stretches will
suppress lower order stretches whenever they appear in the same scope on
the same qubits.</p>
</div>
</div>
<div class="section" id="aliasing">
<h4>Aliasing<a class="headerlink" href="#aliasing" title="Permalink to this headline">¶</a></h4>
<p>The keyword allows quantum bits and registers to be referred to by
another name as long as the alias is in scope. For example, creates a
new reference to the last 4 qubits of the register . The qubit refers to
the qubit .</p>
</div>
<div class="section" id="register-concatenation-and-slicing">
<h4>Register concatenation and slicing<a class="headerlink" href="#register-concatenation-and-slicing" title="Permalink to this headline">¶</a></h4>
<p>Two or more registers of the same type (i.e. classical or quantum) can
be concatenated to form a register of the same type whose size is the
sum of the sizes of the individual registers. The concatenated register
is a reference to the bits or qubits of the original registers. The
statement denotes the concatenation of registers and . A register cannot
be concatenated with any part of itself.</p>
<p>Classical and quantum registers can be indexed in a way that selects a
subset of (qu)bits, i.e. by an index set. A register so indexed is
interpreted as a register of the same type but with a different size.
The register slice is a reference to the original register. A register
cannot be indexed by an empty index set.</p>
<p>An index set can be specified by a single unsigned integer, a
comma-separated list of unsigned integers <code class="docutils literal notranslate"><span class="pre">a,b,c,…</span></code>, or a range. A
range is written as or where , , and are integers (signed or unsigned).
The range corresponds to the set <span class="math notranslate nohighlight">\(\{a, a+c, a+2c, \dots, a+mc\}\)</span>
where <span class="math notranslate nohighlight">\(m\)</span> is the largest integer such that <span class="math notranslate nohighlight">\(a+mc\leq b\)</span> if
<span class="math notranslate nohighlight">\(c&gt;0\)</span> and <span class="math notranslate nohighlight">\(a+mc\geq b\)</span> if <span class="math notranslate nohighlight">\(c&lt;0\)</span>. If <span class="math notranslate nohighlight">\(a=b\)</span> then
the range corresponds to <span class="math notranslate nohighlight">\(\{a\}\)</span>. Otherwise, the range is the
empty set. If <span class="math notranslate nohighlight">\(c\)</span> is not given, it is assumed to be one, and
<span class="math notranslate nohighlight">\(c\)</span> cannot be zero. Note the index sets can be defined by
variables whose values may only be known at run time.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">qubit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">one</span><span class="p">;</span>
<span class="n">qubit</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">two</span><span class="p">;</span>
<span class="c1">// Aliased register of twelve qubits</span>
<span class="n">let</span> <span class="n">concatenated</span> <span class="o">=</span> <span class="n">one</span> <span class="o">||</span> <span class="n">two</span><span class="p">;</span>
<span class="c1">// First qubit in aliased qubit array</span>
<span class="n">let</span> <span class="n">first</span> <span class="o">=</span> <span class="n">concatenated</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="c1">// Last qubit in aliased qubit array</span>
<span class="n">let</span> <span class="n">last</span> <span class="o">=</span> <span class="n">concatenated</span><span class="p">[</span><span class="mi">-1</span><span class="p">];</span>
<span class="c1">// Qubits zero, three and five</span>
<span class="n">let</span> <span class="n">qubit_selection</span> <span class="o">=</span> <span class="n">two</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
<span class="c1">// First six qubits in aliased qubit array</span>
<span class="n">let</span> <span class="n">sliced</span> <span class="o">=</span> <span class="n">concatenated</span><span class="p">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">6</span><span class="p">];</span>
<span class="c1">// Every second qubit</span>
<span class="n">let</span> <span class="n">every_second</span> <span class="o">=</span> <span class="n">concatenated</span><span class="p">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">12</span><span class="p">];</span>
</pre></div>
</div>
</div>
</div>
<span id="document-language/gates"></span><div class="section" id="gates">
<h3>Gates<a class="headerlink" href="#gates" title="Permalink to this headline">¶</a></h3>
<p>In OpenQASM we refer to unitary quantum instructions as gates.</p>
<div class="section" id="built-in-gates">
<h4>Built-in gates<a class="headerlink" href="#built-in-gates" title="Permalink to this headline">¶</a></h4>
<p>We define a mechanism for parameterizing unitary matrices to define new
quantum gates. The parameterization uses a built-in universal gate set
of single-qubit gates and a two-qubit entangling gate (CNOT)
<span class="bibtex" id="id1">[barenco95]</span>. This basis is not an enforced compilation
target but a mechanism to define other gates. For many gates of
practical interest, there is a circuit representation with a polynomial
number of one- and two-qubit gates, giving a more compact representation
than requiring the programmer to express the full <span class="math notranslate nohighlight">\(n \times n\)</span>
matrix. However, a general <span class="math notranslate nohighlight">\(n\)</span>-qubit gate can be defined using an
exponential number of these gates.</p>
<p>We now describe this built-in gate set. There is one built-in two-qubit
gate</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathrm{CX} := \left(\begin{array}{cccc}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \end{array}\right)\end{split}\]</div>
<p>called the controlled-NOT gate. The statement describes a CNOT gate that
flips the target qubit if and only if the control qubit is one. The
arguments cannot refer to the same qubit. If and are quantum registers
<em>with the same size</em>, the statement means apply for each index into
register . If instead, is a qubit and is a quantum register, the
statement means apply for each index into register . Finally, if is a
quantum register and is a qubit, the statement means apply for each
index into register .</p>
<p>.</p>
<p>All of the single-qubit unitary gates are also built-in and
parameterized as</p>
<div class="math notranslate nohighlight">
\[\begin{split}U(\theta,\phi,\lambda) := R_z(\phi)R_y(\theta)R_z(\lambda) = \left(\begin{array}{cc}
    e^{-i(\phi+\lambda)/2}\cos(\theta/2) &amp; -e^{-i(\phi-\lambda)/2}\sin(\theta/2) \\
e^{i(\phi-\lambda)/2}\sin(\theta/2) &amp; e^{i(\phi+\lambda)/2}\cos(\theta/2) \end{array}\right).\end{split}\]</div>
<p>Here <span class="math notranslate nohighlight">\(R_y(\theta)=\mathrm{exp}(-i\theta Y/2)\)</span> and
<span class="math notranslate nohighlight">\(R_z(\phi)=\mathrm{exp}(-i\theta Z/2)\)</span>. When is a quantum
register, the statement means apply for each index into register . The
values <span class="math notranslate nohighlight">\(\theta\in [0,2\pi)\)</span>, <span class="math notranslate nohighlight">\(\phi\in [0,2\pi)\)</span>, and
<span class="math notranslate nohighlight">\(\lambda\in
[0,2\pi)\)</span> in this base gate are angles whose precision is implementation
dependent <a class="footnote-reference brackets" href="#id3" id="id2">1</a>. This specifies any element of <span class="math notranslate nohighlight">\(SU(2)\)</span> up to a
global phase. For example, applies a Hadamard gate to qubit .</p>
<p>Finally, a built-in global phase gate allows the inclusion of arbitrary
global phase on circuits. adds a global phase of <span class="math notranslate nohighlight">\(e^{i\gamma}\)</span> to
the circuit. e.g.:</p>
</div>
<div class="section" id="hierarchically-defined-unitary-gates">
<span id="sec-macros"></span><h4>Hierarchically defined unitary gates<a class="headerlink" href="#hierarchically-defined-unitary-gates" title="Permalink to this headline">¶</a></h4>
<p>For new gates, we associate them with a corresponding unitary
transformation by a sequence of built-in gates. For example, a CPHASE
operation is shown schematically in Fig. <a class="reference external" href="#fig:gate">[fig:gate]</a>. The
corresponding OpenQASM code is</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>gate cphase(angle[32]: θ) a, b
{
  U(0, 0, θ / 2) a;
  CX a, b;
  U(0, 0, -θ / 2) b;
  CX a, b;
  U(0, 0, θ / 2) b;
}
cphase(π / 2) q[0], q[1];
</pre></div>
</div>
<p>Note that this definition does not imply that must be implemented with
this series of gates. Rather, we have specified the unitary
transformation that corresponds to the symbol . The particular
implementation is up to the compiler, given information about the basis
gate set supported by a particular target.</p>
<p>In general, new gates are defined by statements of the form</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// comment</span>
<span class="n">gate</span> <span class="nf">name</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="n">qargs</span>
<span class="p">{</span>
  <span class="n">body</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where the optional parameter list is a comma-separated list of variable
parameters, and the argument list is a comma-separated list of qubit
arguments. The parameters are identifiers with angular types and default
to 32-bits. The qubit arguments are identifiers. If there are no
variable parameters, the parentheses are optional. At least one qubit
argument is required. The arguments in cannot be indexed within the body
of the gate definition.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// this is ok:</span>
<span class="n">gate</span> <span class="n">g</span> <span class="n">a</span>
<span class="p">{</span>
  <span class="n">U</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// this is invalid:</span>
<span class="n">gate</span> <span class="n">g</span> <span class="n">a</span>
<span class="p">{</span>
  <span class="n">U</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Only built-in gate statements, calls to previously defined gates, and
timing directives can appear in . For example, it is not valid to
declare a classical register in a gate body. The statements in the body
can only refer to the symbols given in the parameter or argument list,
and these symbols are scoped only to the subroutine body. An empty body
corresponds to the identity gate. Gates must be declared before use and
cannot call themselves. The statement applies the gate, and the variable
parameters are given as angular types or in-place constant parameter
expressions which are cast to angles. The gate can be applied to any
combination of qubits and quantum registers <em>of the same size</em> as shown
in the following example. The quantum circuit given by</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">gate</span> <span class="n">g</span> <span class="n">qb0</span><span class="p">,</span> <span class="n">qb1</span><span class="p">,</span> <span class="n">qb2</span><span class="p">,</span> <span class="n">qb3</span>
<span class="p">{</span>
  <span class="c1">// body</span>
<span class="p">}</span>
<span class="n">qubit</span> <span class="n">qr0</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">qubit</span> <span class="n">qr1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">qubit</span> <span class="n">qr2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="n">qubit</span> <span class="n">qr3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">g</span> <span class="n">qr0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qr1</span><span class="p">,</span> <span class="n">qr2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qr3</span><span class="p">;</span> <span class="c1">// ok</span>
<span class="n">g</span> <span class="n">qr0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qr2</span><span class="p">,</span> <span class="n">qr1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">qr3</span><span class="p">;</span> <span class="c1">// error!</span>
</pre></div>
</div>
<p>has a second-to-last line that means</p>
<p>We provide this so that user-defined gates can be applied in parallel
like the built-in gates.</p>
</div>
<div class="section" id="quantum-gate-modifiers">
<h4>Quantum gate modifiers<a class="headerlink" href="#quantum-gate-modifiers" title="Permalink to this headline">¶</a></h4>
<p>A gate modifier is a keyword that applies to a gate. A modifier
<span class="math notranslate nohighlight">\(m\)</span> transforms a gate <span class="math notranslate nohighlight">\(U\)</span> to a new gate <span class="math notranslate nohighlight">\(m(U)\)</span> acting
on the same or larger Hilbert space. We include modifiers in OpenQASM
both for programming convenience and compiler analysis.</p>
<p>The modifier replaces its gate argument <span class="math notranslate nohighlight">\(U\)</span> with its inverse
<span class="math notranslate nohighlight">\(U^\dagger\)</span>. The inverse of any gate can be defined recursively by
reversing the order of the gates in its definition and replacing each of
those with their inverse. The base case is given by replacing with and
by .</p>
<p>The modifier replaces its gate argument <span class="math notranslate nohighlight">\(U\)</span> by its <span class="math notranslate nohighlight">\(k\)</span>th
power <span class="math notranslate nohighlight">\(U^k\)</span> for some positive integer <span class="math notranslate nohighlight">\(k\)</span> (not necessarily
constant). Such a gate can be trivially defined as <span class="math notranslate nohighlight">\(k\)</span> repetitions
of the original gate, although more efficient implementations may be
possible.</p>
<p>The modifier replaces its gate argument <span class="math notranslate nohighlight">\(U\)</span> by a
controlled-<span class="math notranslate nohighlight">\(U\)</span> gate. The new control qubit is prepended to the
argument list for the controlled-<span class="math notranslate nohighlight">\(U\)</span> gate. The modified gate does
not use any additional scratch space. A target may or may not be able to
execute the gate without further compilation.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>// Define a controlled Rz operation using the ctrl gatemodifier.
gate crz(angle[20]: θ) q1, q2 {
    ctrl @ U(θ, 0, 0) q1, q2;
}
</pre></div>
</div>
<dl class="footnote brackets">
<dt class="label" id="id3"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>The intention is that the accuracy of these built-in gates is
sufficient for the accuracy of the derived gates to not be limited by
that of the built-in gates.</p>
</dd>
</dl>
</div>
</div>
<span id="document-language/insts"></span><div class="section" id="built-in-quantum-instructions">
<h3>Built-in quantum instructions<a class="headerlink" href="#built-in-quantum-instructions" title="Permalink to this headline">¶</a></h3>
<p>This sections describes built-in non-unitary operations.</p>
<div class="section" id="initialization">
<h4>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h4>
<p>The statement resets a qubit or quantum register to the state
<span class="math notranslate nohighlight">\(|0\rangle\)</span>. This corresponds to a partial trace over those qubits
(i.e. discarding them) before replacing them with
<span class="math notranslate nohighlight">\(|0\rangle\langle 0|\)</span>. Reset is shown in
Fig. <a class="reference external" href="#fig:prepare">[fig:prepare]</a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Initialize and reset an array of 10 qubits</span>
<span class="n">qubit</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">qubits</span><span class="p">;</span>
<span class="n">reset</span> <span class="n">qubits</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="measurement">
<h4>Measurement<a class="headerlink" href="#measurement" title="Permalink to this headline">¶</a></h4>
<p>The statement measures the qubit(s) in the <span class="math notranslate nohighlight">\(Z\)</span>-basis and assigns
the measurement outcome(s) to the target bit(s). For backwards
compatibility this is equivalent to which is also supported. Measurement
corresponds to a projection onto one of the eigenstates of <span class="math notranslate nohighlight">\(Z\)</span>,
and qubit(s) are immediately available for further quantum computation.
Both arguments must be register-type, or both must be bit-type. If both
arguments are register-type and have the same size, the statement
broadcasts to for each index into register . Measurement is shown in
Fig. <a class="reference external" href="#fig:measure">[fig:measure]</a>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Initialize, flip and measure an array of 10 qubits</span>
<span class="n">qubit</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">qubits</span><span class="p">;</span>
<span class="n">bit</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">bits</span><span class="p">;</span>
<span class="n">x</span> <span class="n">qubits</span><span class="p">;</span>
<span class="n">bits</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">qubits</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<span id="document-language/classical"></span><div class="section" id="classical-instructions">
<h3>Classical instructions<a class="headerlink" href="#classical-instructions" title="Permalink to this headline">¶</a></h3>
<p>We envision two levels of classical control that we call low-level
instructions and high-level kernel functions. Simple, fast instructions
control the flow of the program and allow basic computations on
lower-level parallel control processors. These instructions are likely
to have known durations and many such instructions might be executed
within the qubit coherence time. High-level kernel functions execute
arbitrary user-defined classical subroutines that may be neither fast
nor guaranteed to return. These assume a mechanism for passing data to
and from higher-level processors. The kernel functions run on the global
processor concurrently with operations on the local processors, if
possible. Kernel functions can write to the global controller’s memory,
which may not be directly accessible by the local controllers.</p>
<div class="section" id="low-level-classical-instructions">
<h4>Low-level classical instructions<a class="headerlink" href="#low-level-classical-instructions" title="Permalink to this headline">¶</a></h4>
<div class="section" id="generalities">
<h5>Generalities<a class="headerlink" href="#generalities" title="Permalink to this headline">¶</a></h5>
<p>All types support the assignment operator . The left-hand-side (LHS) and
right-hand-side (RHS) of the assignment operator must be of the same
type. For real-time values assignment is by copy of the RHS value to the
assigned variable on the LHS.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">a</span><span class="p">;</span>
<span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// Combined declaration and assignment</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// Assign b to a</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// False</span>
<span class="n">a</span> <span class="o">==</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// True</span>
</pre></div>
</div>
</div>
<div class="section" id="classical-bits-and-registers">
<h5>Classical bits and registers<a class="headerlink" href="#classical-bits-and-registers" title="Permalink to this headline">¶</a></h5>
<p>Classical registers and bits support bitwise operators and the
corresponding assignment operators between registers of the same size:
and , or , xor . They support left shift and right shift by an unsigned
integer, and the corresponding assignment operators. The shift operators
shift bits off the end. They also support not ,  <a class="footnote-reference brackets" href="#id4" id="id1">1</a>, and left and
right circular shift, and , respectively.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">bit</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">a</span> <span class="o">=</span> <span class="s">&quot;10001111&quot;</span><span class="p">;</span>
<span class="n">bit</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">b</span> <span class="o">=</span> <span class="s">&quot;01110000&quot;</span><span class="p">;</span>

<span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Bit shift left produces &quot;00011110&quot;</span>
<span class="n">rotl</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">// Produces &quot;00111110&quot;</span>
<span class="n">a</span> <span class="o">|</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// Produces &quot;11111111&quot;</span>
<span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// Produces &quot;00000000&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="comparison-boolean-instructions">
<h5>Comparison (Boolean) Instructions<a class="headerlink" href="#comparison-boolean-instructions" title="Permalink to this headline">¶</a></h5>
<p>Integers, fixed-point numbers, angles, bits, and classical registers can
be compared (<span class="math notranslate nohighlight">\(&gt;\)</span>, <span class="math notranslate nohighlight">\(&gt;=\)</span>, <span class="math notranslate nohighlight">\(&lt;\)</span>, <span class="math notranslate nohighlight">\(&lt;=\)</span>, <span class="math notranslate nohighlight">\(==\)</span>,
<span class="math notranslate nohighlight">\(!=\)</span>) and yield Boolean values. Boolean values support logical
operators: and , or , not . The keyword tests if an integer belongs to
an index set, for example returns if i equals 0 or 3 and otherwise.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="n">a</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">fixed</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">1.05</span><span class="p">;</span>
<span class="n">angle</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">d</span> <span class="o">=</span> <span class="n">pi</span><span class="p">;</span>
<span class="kt">float</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">e</span> <span class="o">=</span> <span class="n">pi</span><span class="p">;</span>

<span class="n">a</span> <span class="o">==</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// True</span>
<span class="n">a</span> <span class="o">==</span> <span class="kt">bool</span><span class="p">(</span><span class="n">b</span><span class="p">);</span> <span class="c1">// False</span>
<span class="n">c</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// True</span>
<span class="n">d</span> <span class="o">==</span> <span class="n">pi</span><span class="p">;</span> <span class="c1">// True</span>
<span class="c1">// Susceptible to floating point casting errors</span>
<span class="n">e</span> <span class="o">==</span> <span class="kt">float</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="integers">
<h5>Integers<a class="headerlink" href="#integers" title="Permalink to this headline">¶</a></h5>
<p>Integer types support addition , subtraction , multiplication, and
division <a class="footnote-reference brackets" href="#id5" id="id2">2</a>; the corresponding assignments , , , and ; as well as
increment and decrement .</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// 5</span>
<span class="n">a</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// a == 6</span>
<span class="n">a</span> <span class="o">/=</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// a == 2</span>
<span class="n">a</span><span class="o">++</span><span class="p">;</span> <span class="c1">// a == 3</span>
</pre></div>
</div>
</div>
<div class="section" id="fixed-point-numbers-and-angles">
<h5>Fixed-point numbers and angles<a class="headerlink" href="#fixed-point-numbers-and-angles" title="Permalink to this headline">¶</a></h5>
<p>Fixed-point and angle types support addition, subtraction,
multiplication, and division and the corresponding assignment operators.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">angle</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="n">a</span> <span class="o">=</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">angle</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="n">b</span> <span class="o">=</span> <span class="n">pi</span><span class="p">;</span>
<span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// 3/2 * pi</span>
<span class="n">angle</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">c</span><span class="p">;</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">angle</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">);</span> <span class="c1">// cast to angle[10]</span>
</pre></div>
</div>
</div>
<div class="section" id="looping-and-branching">
<h5>Looping and branching<a class="headerlink" href="#looping-and-branching" title="Permalink to this headline">¶</a></h5>
<p>The statement branches to program if the Boolean evaluates to true and
may optionally be followed by .</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="n">target</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="n">qubit</span> <span class="n">a</span><span class="p">;</span>
<span class="n">h</span> <span class="n">a</span><span class="p">;</span>
<span class="n">bit</span> <span class="n">output</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">qubit</span>

<span class="c1">// example of branching</span>
<span class="k">if</span> <span class="p">(</span><span class="n">target</span> <span class="o">==</span> <span class="n">output</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">// do something</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
   <span class="c1">// do something else</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The statement loops over integer values in the indexset, assigning them
to . The for loop body is not permitted to modify the loop variable of
the indexset.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">b</span><span class="p">;</span>
<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">}</span> <span class="p">{</span>
    <span class="n">b</span> <span class="o">+=</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// b == 16</span>
</pre></div>
</div>
<p>The statement executes program until the Boolean evaluates to
false <a class="footnote-reference brackets" href="#id6" id="id3">3</a>. Variables in the loop condition statement may be modified
within the while loop body.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">qubit</span> <span class="n">q</span><span class="p">;</span>
<span class="n">bit</span> <span class="n">result</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// Keep applying hadamards and measuring a qubit</span>
<span class="c1">// until 10, |1&gt;s are measured</span>
<span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">h</span> <span class="n">q</span><span class="p">;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">q</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A block can be exited with the statement . The statement can appear in
the body of a for or while loop. It returns control to the loop
condition. The statement terminates the program. In all of the
preceding, can also be replaced by a statement without the braces.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="c1">// continue to next loop iteration</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// some program</span>

    <span class="c1">// break out of loop</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// more program</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="kernel-function-calls">
<h4>Kernel function calls<a class="headerlink" href="#kernel-function-calls" title="Permalink to this headline">¶</a></h4>
<p>Kernel functions are declared by giving their signature using the
statement where inputs is a comma-separated list of type names and
output is a single type name. They can be functions of any number of
arguments whose types correspond to the classical types of OpenQASM.
Inputs are passed by value. They can return zero or one value whose type
is any classical type in OpenQASM except real constants. If necessary,
multiple return values can be accommodated by concatenating registers.
The type and size of each argument must be known at compile time to
define data flow and enable scheduling. We do not address issues such as
how the kernel functions are defined and registered.</p>
<p>Kernel functions are invoked using the statement The functions are not
required to be idempotent. They may change the state of the process
providing the function. In our computational model, the kernel functions
are assumed to run concurrently with other classical and quantum
computations. The output of a kernel function can be assigned to a
variable on declaration using the assignment operator rather than the
arrow notation.</p>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>computes the Hamming weight of the input register.</p>
</dd>
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>If multiplication and division instructions are not available in
hardware, they can be implemented by expanding into other
instructions.</p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>This clearly allows users to write code that does not terminate. We
do not discuss implementation details here, but one possibility is to
compile into target code that imposes iteration limits</p>
</dd>
</dl>
</div>
</div>
<span id="document-language/subroutines"></span><div class="section" id="subroutines">
<h3>Subroutines<a class="headerlink" href="#subroutines" title="Permalink to this headline">¶</a></h3>
<p>Subroutines are declared using the statement . Zero or more quantum bits
and registers are passed to the subroutine by reference or name in .
Classical types are passed by value in . The subroutines return up to
one classical type. All arguments are declared together with their type,
for example would define a quantum bit argument named . The output of a
subroutine can be assigned to a variable on declaration using the
assignment operator rather than the arrow notation.</p>
<p>Using subroutines, we can define an X-basis measurement with the program
. We can also define more general classes of single-qubit measurements
as . The type declarations are necessary if we want to mix qubit and
register arguments. For example, we might define a parity check
subroutine that takes qubits and registers</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">def</span> <span class="n">xcheck</span> <span class="n">qubit</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">:</span><span class="n">d</span><span class="p">,</span> <span class="nl">qubit</span><span class="p">:</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">bit</span> <span class="p">{</span>
  <span class="n">reset</span> <span class="n">a</span><span class="p">;</span>
  <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span> <span class="mi">3</span><span class="p">]</span> <span class="n">cx</span> <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">measure</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Naturally we can also use subroutines to define purely classical
operations, such as methods we can implement using low-level classical
instructions, like</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">n</span> <span class="o">=</span> <span class="cm">/* some size, known at compile time */</span><span class="p">;</span>
<span class="n">def</span> <span class="nf">parity</span><span class="p">(</span><span class="n">bit</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">:</span><span class="n">cin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">bit</span> <span class="p">{</span>
  <span class="n">bit</span> <span class="n">c</span><span class="p">;</span>
  <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="p">{</span>
    <span class="n">c</span> <span class="o">^=</span> <span class="n">cin</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can make some measurements and call this subroutine on the results as
follows</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">q</span><span class="p">;</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">r</span><span class="p">;</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">parity</span><span class="p">(</span><span class="n">c</span> <span class="o">||</span> <span class="n">c2</span><span class="p">);</span>
</pre></div>
</div>
<p>We require that we know the signature at compile time, as we do in this
example. We could also just as easily have used a kernel function for
this</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">n</span> <span class="o">=</span> <span class="cm">/* size of c + size of c2 */</span><span class="p">;</span>
<span class="n">kernel</span> <span class="n">parity</span> <span class="n">bit</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">bit</span><span class="p">;</span>
<span class="n">measure</span> <span class="n">q</span> <span class="o">-&gt;</span> <span class="n">c</span><span class="p">;</span>
<span class="n">measure</span> <span class="n">r</span> <span class="o">-&gt;</span> <span class="n">c2</span>
<span class="n">parity</span><span class="p">(</span><span class="n">c</span> <span class="o">||</span> <span class="n">c2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">result</span><span class="p">;</span>
</pre></div>
</div>
</div>
<span id="document-language/directives"></span><div class="section" id="directives">
<h3>Directives<a class="headerlink" href="#directives" title="Permalink to this headline">¶</a></h3>
<p>OpenQASM supports a directive mechanism that allows other information to
be included in the program. A directive begins with <code class="docutils literal notranslate"><span class="pre">#pragma</span></code> and
terminates at the end of the line. Directives can provide annotations
that give additional information to compiler passes and the target
system or simulator. Ideally the meaning of the program does not change
if some or all of the directives are ignored, so they can be interpreted
at the discretion of the consuming process.</p>
</div>
<span id="document-language/delays"></span><div class="section" id="circuit-timing">
<h3>Circuit timing<a class="headerlink" href="#circuit-timing" title="Permalink to this headline">¶</a></h3>
<p>A key aspect of expressing code for quantum experiments is the ability
to control the timing of gates and pulses. Examples include
characterization of decoherence and crosstalk, dynamical decoupling,
dynamically corrected gates, and gate scheduling. This can be a
challenging task given the potential heterogeneity of calibrated gates
and their various durations. It is useful to specify gate timing and
parallelism in a way that is independent of the precise duration and
implementation of gates at the pulse-level description. In other words,
we want to provide the ability to capture <em>design intent</em> such as “space
these gates evenly to implement a higher-order echo decoupling sequence”
or “implement this gate as late as possible”.</p>
<div class="section" id="length-and-stretch-types">
<h4>length and stretch types<a class="headerlink" href="#length-and-stretch-types" title="Permalink to this headline">¶</a></h4>
<p>The type is used denote duration of time. Lengths are positive numbers
that are manipulated at compile time. Lengths have units which can be
any of the following:</p>
<ul class="simple">
<li><p>SI units of time, such as</p></li>
<li><p>Backend-dependent unit, , equivalent to the duration of one waveform
sample on the backend</p></li>
</ul>
<p>It is often useful to reference the duration of other parts of the
circuit. For example, we may want to delay a gate for twice the duration
of a particular sub-circuit, without knowing the exact value to which
that duration will resolve. Alternatively, we may want to calibrate a
gate using some pulses, and use its duration as a new in order to delay
other parts of the circuit. The intrinsic function can be used for this
type of referential timing.</p>
<p>Below are some examples of values of type .</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// fixed length, in standard units</span>
<span class="n">length</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">300</span><span class="n">ns</span><span class="p">;</span>
<span class="c1">// fixed length, backend dependent</span>
<span class="n">length</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">800</span><span class="n">dt</span><span class="p">;</span>
<span class="c1">// fixed length, referencing the duration of a calibrated gate</span>
<span class="n">length</span> <span class="n">c</span> <span class="o">=</span> <span class="n">lengthof</span><span class="p">(</span><span class="n">defcal</span><span class="p">);</span>
<span class="c1">// dynamic length, referencing a box within its context</span>
<span class="n">length</span> <span class="n">d</span> <span class="o">=</span> <span class="n">lengthof</span><span class="p">(</span><span class="n">box</span><span class="p">);</span>
</pre></div>
</div>
<p>We further introduce a type which is a sub-type of . Stretchable lengths
have variable non-negative length that is permitted to grow as necessary
to satisfy constraints. Stretch variables are resolved at compile time
into target-appropriate durations that satisfy a user’s specified design
intent.</p>
<p>Instructions whose duration is specified in this way become “stretchy”,
meaning they can extend beyond their “natural length” to fill a span of
time. Stretchy s are the most obvious use case, but this can be extended
to other instructions too, e.g. rotating a spectator qubit while another
gate is in progress. Similarly, a whose definition contains stretchy
delays will be perceived as a stretchy gate by other parts of the
program.</p>
<p>For example, in order to ensure a sequence of gates between two barriers
will be left-aligned (Figure <a class="reference external" href="#fig:alignment">[fig:alignment]</a>a),
whatever their actual durations may be, we can do the following:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">u</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="n">delay</span><span class="p">[</span><span class="n">stretchinf</span><span class="p">]</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">delay</span><span class="p">[</span><span class="n">stretchinf</span><span class="p">]</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">delay</span><span class="p">[</span><span class="n">stretchinf</span><span class="p">]</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
</pre></div>
</div>
<p>We can further control the exact alignment by giving relative weights to
the stretchy delays (Figure <a class="reference external" href="#fig:alignment">[fig:alignment]</a>b):</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">stretch</span> <span class="n">g</span><span class="p">;</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">delay</span><span class="p">[</span><span class="n">g</span><span class="p">];</span>
<span class="n">u</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">delay</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="p">];</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
</pre></div>
</div>
<p>[fig:leftalign]</p>
<p>[fig:leftalignresolved]</p>
<p>Lastly, we distinguish different “orders” of stretch via types, where N
is an integer between 0 to 255. is an alias for the regular . Higher
order stretches will suppress lower order stretches whenever they appear
in the same scope on the same qubits. A keyword is defined as an
infinitely stretchable length. It will always take precedence, and will
not changed if arithmetic operations are done on it. This is most useful
as a “don’t care” mechanism to specify delays that will just fill
whatever gap is present.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// stretchable length, with min=0 and max=inf</span>
<span class="n">stretch</span> <span class="n">e</span><span class="p">;</span>
<span class="n">delay</span><span class="p">[</span><span class="n">e</span><span class="p">];</span>
<span class="c1">// higher-order stretch which always mutes lower-order stretch</span>
<span class="n">stretch2</span> <span class="n">f</span><span class="p">;</span>
<span class="n">delay</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="p">];</span>
<span class="c1">// infinitely stretchable length, always anonymous.</span>
<span class="c1">// other instruction don&#39;t care about the value to which this resolves.</span>
<span class="n">delay</span><span class="p">[</span><span class="n">stretchinf</span><span class="p">];</span>
</pre></div>
</div>
<p>The concepts of and are inspired by the concept of “boxes and glues” in
the TeX language <span class="bibtex" id="id1">[knuth1984texbook]</span>. This similarity
is natural; TeXaims to resolve the spacing between characters in order
to typeset a page, and the size of characters depend on the backend
font. In OpenQASM we intend to resolve the timing of different
instructions in order to meet high-level design intents, while the true
length of operations depend on the backend and compilation context.
There are however some key differences. Quantum operations can be
non-local, meaning the lengths set on one qubit can have side effects on
other qubits. The definition of -type variables and ability to define
multi-qubit stretches is intended to alleviate potential problems from
these side effects. Also contrary to TeX, we prohibit overlapping gates.</p>
</div>
<div class="section" id="operations-on-lengths">
<h4>Operations on lengths<a class="headerlink" href="#operations-on-lengths" title="Permalink to this headline">¶</a></h4>
<p>We can add two lengths, or multiply them by a constant, to get new
lengths. These are compile time operations since ultimately all lengths,
including stretches, will be resolved to constants.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">length</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">300</span><span class="n">ns</span>
<span class="n">length</span> <span class="n">b</span> <span class="o">=</span> <span class="n">lengthof</span><span class="p">({</span><span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">})</span>
<span class="n">stretch</span> <span class="n">c</span><span class="p">;</span>
<span class="c1">// stretchy length with min=300ns</span>
<span class="n">length</span> <span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">c</span>
<span class="c1">// stretchy length with backtracking by up to half b</span>
<span class="n">length</span> <span class="n">e</span> <span class="o">=</span> <span class="mf">-0.5</span> <span class="o">*</span> <span class="n">b</span> <span class="o">+</span> <span class="n">c</span>
</pre></div>
</div>
</div>
<div class="section" id="delays-and-other-lengthed-instructions">
<h4>Delays (and other lengthed instructions)<a class="headerlink" href="#delays-and-other-lengthed-instructions" title="Permalink to this headline">¶</a></h4>
<p>OpenQASM and OpenPulse have a instruction, whose duration is defined by
a . If the length passed to the delay contains stretch, it will become a
stretchy delay. We use square bracket notation to pass these length
parameters, to distinguish them from regular parameters (the compiler
will resolve these square-bracket parameters when resolving timing ).</p>
<p>Even though a instruction implements the identity channel in the ideal
case, it is intended to provide explicit timing. Therefore an explicit
instruction will prevent commutation of gates that would otherwise
commute. For example in
Figure <a class="reference external" href="#fig:delaycommute">[fig:delaycommute]</a>a, there will be an
implicit delay between the ‘‘ gates on qubit 0. However, the ‘‘ gate is
still free to commute on that qubit, because the delay is implicit. Once
the delay becomes explicit (perhaps at lower stages of compilation),
gate commutation is prohibited
(Figure <a class="reference external" href="#fig:delaycommute">[fig:delaycommute]</a>b).</p>
<p>Instructions other than delay can also have variable duration, if they
are explicitly defined as such. They can be called by passing a valid as
their duration. Consider for example a rotation called that is applied
for the entire duration of some other gate.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="n">amp</span> <span class="o">=</span> <span class="cm">/* number */</span><span class="p">;</span>
<span class="n">stretch</span> <span class="n">a</span><span class="p">;</span>
<span class="n">rotary</span><span class="p">(</span><span class="n">amp</span><span class="p">)[</span><span class="mi">250</span><span class="n">ns</span><span class="p">]</span> <span class="n">q</span><span class="p">;</span>   <span class="c1">// square brackets indicates duration</span>
<span class="n">rotary</span><span class="p">(</span><span class="n">amp</span><span class="p">)[</span><span class="n">a</span><span class="p">]</span> <span class="n">q</span><span class="p">;</span>       <span class="c1">// a rotation that will stretch as needed</span>
</pre></div>
</div>
<p>A multi-qubit instruction is <em>not</em> equivalent to multiple single-qubit
instructions. Instead a multi-qubit delay acts as a synchronization
point on the qubits, where the delay begins from the latest non-idle
time across all qubits, and ends simultaneously across all qubits. For
this reason, a instruction is exactly equivalent to a of a length zero
on the qubits involved.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="c1">// delay for 200 samples starting from the end of the longest cx</span>
<span class="n">delay</span><span class="p">[</span><span class="mi">200</span><span class="n">dt</span><span class="p">]</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">3</span><span class="p">];</span>
</pre></div>
</div>
<p>A can be composed of positive or negative natural length, and of
positive stretch. After resolving the stretch, the instruction must end
up with non-negative duration.</p>
<p>For example, the code below inserts a dynamical decoupling sequence
where the *centers* of pulses are equidistant from each other. We
specify correct lengths for the delays by using backtracking operations
to properly take into account the finite length of each gate.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">stretch</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span>
<span class="n">length</span> <span class="n">start_stretch</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">lengthof</span><span class="p">({</span><span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;})</span>
<span class="n">length</span> <span class="n">middle_stretch</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">lengthof</span><span class="p">({</span><span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;})</span> <span class="o">-</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">lengthof</span><span class="p">({</span><span class="n">y</span> <span class="o">%</span><span class="mi">0</span><span class="p">;}</span>
<span class="n">length</span> <span class="n">end_stretch</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="mf">.5</span> <span class="o">*</span> <span class="n">lengthof</span><span class="p">({</span><span class="n">y</span> <span class="o">%</span><span class="mi">0</span><span class="p">;})</span>

<span class="n">delay</span><span class="p">[</span><span class="n">start_stretch</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
<span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
<span class="n">delay</span><span class="p">[</span><span class="n">middle_stretch</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
<span class="n">y</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
<span class="n">delay</span><span class="p">[</span><span class="n">middle_stretch</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span><span class="o">=</span>
<span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
<span class="n">delay</span><span class="p">[</span><span class="n">middle_stretch</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
<span class="n">y</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
<span class="n">delay</span><span class="p">[</span><span class="n">end_stretch</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>

<span class="n">cx</span> <span class="o">%</span><span class="mi">2</span><span class="p">,</span> <span class="o">%</span><span class="mi">3</span><span class="p">;</span>
<span class="n">delay</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">%</span><span class="mi">1</span><span class="p">;</span>
<span class="n">cx</span> <span class="o">%</span><span class="mi">1</span><span class="p">,</span> <span class="o">%</span><span class="mi">2</span><span class="p">;</span>
<span class="n">u</span> <span class="o">%</span><span class="mi">3</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="boxed-expressions">
<h4>Boxed expressions<a class="headerlink" href="#boxed-expressions" title="Permalink to this headline">¶</a></h4>
<p>We introduce a expression for scoping a particular part of the circuit.
A boxed subcircuit can never be inlined (until target code generation
time), and optimizations across the boundary of a box are forbidden. The
contents inside the box can be optimized. The contents around the box
can be optimized too, e.g. it is permissible to commute a gate past a
box by knowing the unitary implemented by the box. Delays that are
within a box are implementation details of the box; they are invisible
to the outside scope and therefore do not prevent commutation.</p>
<p>We introduce a expression for labeling a box. We primarily use this to
later refer to the length of this box. Boxed expressions are good for
this because their contents are isolated and cannot be combined with
gates outside the box. Therefore, no matter how the contents of the box
get optimized, the has a well-defined meaning.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">boxas</span> <span class="n">mybox</span> <span class="p">{</span>
    <span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">delay</span><span class="p">[</span><span class="mi">200</span><span class="n">ns</span><span class="p">]</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
<span class="n">delay</span><span class="p">[</span><span class="n">length</span><span class="p">(</span><span class="n">mybox</span><span class="p">)]</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</pre></div>
</div>
<p>We introduce a expression. The contents of it will be boxed, and in
addition a total duration will be assigned to the box. This is useful
for conditionals where the box will declare a hard deadline. The natural
length of the box must be smaller than the declared boxto duration,
otherwise a compile-time error will be raised. The stretch inside the
box will always be set to fill the difference between the declared
length and the natural length.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// defines a 1ms box whose content is just a centered CNOT</span>
 <span class="n">boxto</span> <span class="mi">1</span><span class="n">ms</span> <span class="p">{</span>
     <span class="n">stretch</span> <span class="n">a</span><span class="p">;</span>
     <span class="n">delay</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">q</span><span class="p">;</span>
     <span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
     <span class="n">delay</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="n">q</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="barrier-instruction">
<h4>Barrier instruction<a class="headerlink" href="#barrier-instruction" title="Permalink to this headline">¶</a></h4>
<p>The instruction of OpenQASM 2 prevents commutation and gate reordering
on a set of qubits across its source line. The syntax is and can be seen
in the following example</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">cx</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">h</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">h</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">barrier</span> <span class="n">r</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">h</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">cx</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">cx</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</pre></div>
</div>
<p>This will prevent an attempt to combine the CNOT gates but will not
constrain the pair of gates, which might be executed before or after the
barrier, or cancelled by a compiler.</p>
</div>
</div>
<span id="document-language/pulses"></span><div class="section" id="pulse-level-descriptions-of-gates-and-measurement">
<h3>Pulse-level descriptions of gates and measurement<a class="headerlink" href="#pulse-level-descriptions-of-gates-and-measurement" title="Permalink to this headline">¶</a></h3>
<p>To induce the quantum gates and measurements of a circuit, qubits are
manipulated with classically-controlled stimulus fields. The details of
these stimuli are typically unique per-qubit and may vary over time due
to instabilities in the underlying systems. Furthermore, there is
significant interest in applying optimal control methodologies to the
construction of these controls in order to optimize gate and circuit
performance. As a consequence, we desire to connect gate-level
instructions to the underlying microcoded
<span class="bibtex" id="id1">[wilkesBestWayDesign1989]</span> stimulus programs emitted by
the controllers to implement each operation. In OpenQASM we expose
access to this level of control with pulse-level definitions of gates
and measurement with user-selectable pulse grammar. A future document
will define a textualized representation of one such grammar, OpenPulse.
Here we restrict ourselves to defining the necessary interfaces within
OpenQASM to these pulse-level definitions of gates and measurement.</p>
<p>The entry point to such gate and measurement definitions is the keyword
analogous to the keyword, but where the body specifies a pulse-level
instruction sequence on <em>physical</em> qubits, e.g.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">defcal</span> <span class="nf">rz</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">:</span><span class="n">theta</span><span class="p">)</span> <span class="o">%</span><span class="n">q</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">defcal</span> <span class="n">measure</span> <span class="o">%</span><span class="n">q</span> <span class="o">-&gt;</span> <span class="n">bit</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>We distinguish gate and measurement definitions by the presence of a
return value type in the latter case, analogous to the subroutine syntax
defined earlier. The reference to <em>physical</em> rather than <em>virtual</em>
qubits is critical because quantum registers are no longer
interchangeable at the pulse level. Due to varying physical qubit
properties a microcode definition of a gate on one qubit will not
perform the equivalent operation on another qubit. To meaningfully
describe gates as pulses we must bind operations to specific qubits.
QASM achieves this by prefixing qubit references with <code class="docutils literal notranslate"><span class="pre">%</span></code> to indicate
a specific qubit on the device, e.g. <code class="docutils literal notranslate"><span class="pre">%2</span></code> would refer to physical
qubit 2, while <code class="docutils literal notranslate"><span class="pre">%q</span></code> is an unbound reference to a physical qubit.</p>
<p>As a consequence of the need for specialization of operations on
particular qubits, we expect the same symbol to be defined multiple
times, e.g.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">defcal</span> <span class="n">h</span> <span class="o">%</span><span class="mi">0</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">defcal</span> <span class="n">h</span> <span class="o">%</span><span class="mi">1</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>and so forth. Some operations require further specialization on
parameter values, so we also allow multiple declarations on the same
physical qubits with different parameter values, e.g.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">defcal</span> <span class="nf">rx</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="o">%</span><span class="mi">0</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="n">defcal</span> <span class="nf">rx</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">%</span><span class="mi">0</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>Given multiple definitions of the same symbol, the compiler will match
the most specific definition found for a given operation. Thus, given,</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">defcal</span> <span class="pre">rx(angle[20]:theta)</span> <span class="pre">%q</span>&#160; <span class="pre">...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">defcal</span> <span class="pre">rx(angle[20]:theta)</span> <span class="pre">%0</span>&#160; <span class="pre">...</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">defcal</span> <span class="pre">rx(pi</span> <span class="pre">/</span> <span class="pre">2)</span> <span class="pre">%0</span>&#160; <span class="pre">...</span></code></p></li>
</ol>
<p>the operation <code class="docutils literal notranslate"><span class="pre">rx(pi/2)</span> <span class="pre">%0</span></code> would match to (3), <code class="docutils literal notranslate"><span class="pre">rx(pi)</span> <span class="pre">%0</span></code> would
match (2), <code class="docutils literal notranslate"><span class="pre">rx(pi/2)</span> <span class="pre">%1</span></code> would match (1).</p>
<p>Users specify the grammar used inside blocks with a declaration, or by
an optional grammar string in a definition, e.g.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">defcalgrammar</span> <span class="s">&quot;openpulse&quot;</span><span class="p">;</span>
<span class="n">defcal</span> <span class="s">&quot;openpulse&quot;</span> <span class="n">measure</span> <span class="o">%</span><span class="n">q</span> <span class="o">-&gt;</span> <span class="n">bit</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
</pre></div>
</div>
<p>are two equivalent ways to specify that the definition uses the grammar.</p>
<p>Note that and communicate orthogonal information to the compiler. s
define unitary transformation rules to the compiler. The compiler may
freely invoke such rules on operations while preserving the structure of
a circuit as a collection of s and s. The declarations instead define
elements of a symbol lookup table. As soon as the compiler replaces a
with a definition, we have changed the fundamental structure of the
circuit. Most of the time symbols in the table will also have
corresponding definitions. However, if a userprovides a for a symbol
without a corresponding , then we treat such operations like the gates
of prior versions of OpenQASM.</p>
</div>
</div>
</div>
<span id="document-examples"></span><div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>This section gives several examples of quantum circuits expressed in
OpenQASM (version 3). The circuits use a gate basis defined for the
Quantum Experience.</p>
<div class="section" id="standard-gates">
<h3>Standard gates<a class="headerlink" href="#standard-gates" title="Permalink to this headline">¶</a></h3>
<p>A collection of standard gates are defined in a header file . We define
these standard gates in terms of the abstract gates and . Choosing to
use abstract gates to define additional gates in the library gives some
flexibility to add or change the gate library at a later time without
changing OpenQASM.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Standard gate library</span>

<span class="c1">// phase gate (Z-rotation by lambda)</span>
<span class="n">gate</span> <span class="nf">phase</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">lambda</span><span class="p">)</span> <span class="n">q</span> <span class="p">{</span> <span class="n">U</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">lambda</span><span class="p">)</span> <span class="n">q</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// controlled-NOT</span>
<span class="n">gate</span> <span class="n">cx</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="p">{</span> <span class="n">CX</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// idle gate (identity)</span>
<span class="n">gate</span> <span class="n">id</span> <span class="n">a</span> <span class="p">{</span> <span class="n">U</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// Pauli gate: bit-flip</span>
<span class="n">gate</span> <span class="n">x</span> <span class="n">a</span> <span class="p">{</span> <span class="n">U</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pi</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// Pauli gate: bit and phase flip</span>
<span class="n">gate</span> <span class="n">y</span> <span class="n">a</span> <span class="p">{</span> <span class="n">U</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// Pauli gate: phase flip</span>
<span class="n">gate</span> <span class="n">z</span> <span class="n">a</span> <span class="p">{</span> <span class="n">phase</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// Clifford gate: Hadamard</span>
<span class="n">gate</span> <span class="n">h</span> <span class="n">a</span> <span class="p">{</span> <span class="n">U</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pi</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// Clifford gate: sqrt(Z) phase gate</span>
<span class="n">gate</span> <span class="n">s</span> <span class="n">a</span> <span class="p">{</span> <span class="n">phase</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// Clifford gate: conjugate of sqrt(Z)</span>
<span class="n">gate</span> <span class="n">sdg</span> <span class="n">a</span> <span class="p">{</span> <span class="n">phase</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// C3 gate: sqrt(S) phase gate</span>
<span class="n">gate</span> <span class="n">t</span> <span class="n">a</span> <span class="p">{</span> <span class="n">phase</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// C3 gate: conjugate of sqrt(S)</span>
<span class="n">gate</span> <span class="n">tdg</span> <span class="n">a</span> <span class="p">{</span> <span class="n">phase</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// Rotation around X-axis</span>
<span class="n">gate</span> <span class="n">rx</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">theta</span><span class="p">)</span> <span class="n">a</span> <span class="p">{</span> <span class="n">U</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// rotation around Y-axis</span>
<span class="n">gate</span> <span class="n">ry</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">theta</span><span class="p">)</span> <span class="n">a</span> <span class="p">{</span> <span class="n">U</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// rotation around Z axis</span>
<span class="n">gate</span> <span class="n">rz</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">phi</span><span class="p">)</span> <span class="n">a</span> <span class="p">{</span> <span class="n">phase</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// controlled-Phase</span>
<span class="n">gate</span> <span class="n">cz</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">{</span> <span class="n">h</span> <span class="n">b</span><span class="p">;</span> <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="n">h</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// controlled-Y</span>
<span class="n">gate</span> <span class="n">cy</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">{</span> <span class="n">sdg</span> <span class="n">b</span><span class="p">;</span> <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span> <span class="n">s</span> <span class="n">b</span><span class="p">;</span> <span class="p">}</span>
<span class="c1">// controlled-H</span>
<span class="n">gate</span> <span class="n">ch</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">{</span>
  <span class="n">h</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">sdg</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">h</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">t</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">t</span> <span class="n">b</span><span class="p">;</span> <span class="n">s</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">h</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">s</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">x</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Toffoli</span>
<span class="n">gate</span> <span class="n">ccx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
<span class="p">{</span>
  <span class="n">h</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">tdg</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">t</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">tdg</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">t</span> <span class="n">b</span><span class="p">;</span> <span class="n">t</span> <span class="n">c</span><span class="p">;</span> <span class="n">h</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">t</span> <span class="n">a</span><span class="p">;</span> <span class="n">tdg</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// controlled-swap</span>
<span class="n">gate</span> <span class="n">cswap</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
<span class="p">{</span>
  <span class="n">cx</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">ccx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// controlled-rz</span>
<span class="n">gate</span> <span class="n">crz</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">lambda</span><span class="p">)</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
<span class="p">{</span>
  <span class="n">phase</span><span class="p">(</span><span class="n">lambda</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">phase</span><span class="p">(</span><span class="o">-</span><span class="n">lambda</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// controlled-phase</span>
<span class="n">gate</span> <span class="n">cphase</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">lambda</span><span class="p">)</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
<span class="p">{</span>
  <span class="n">phase</span><span class="p">(</span><span class="n">lambda</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">phase</span><span class="p">(</span><span class="o">-</span><span class="n">lambda</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">phase</span><span class="p">(</span><span class="n">lambda</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// controlled-U</span>
<span class="n">gate</span> <span class="n">cu</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">theta</span><span class="p">,</span><span class="n">angle</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">phi</span><span class="p">,</span><span class="n">angle</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">lambda</span><span class="p">)</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span>
<span class="p">{</span>
  <span class="c1">// implements controlled-U(theta,phi,lambda) with  target t and control c</span>
  <span class="n">phase</span><span class="p">((</span><span class="n">lambda</span> <span class="o">-</span> <span class="n">phi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="n">t</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">c</span><span class="p">,</span><span class="n">t</span><span class="p">;</span>
  <span class="n">U</span><span class="p">(</span><span class="o">-</span><span class="n">theta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="n">phi</span> <span class="o">+</span> <span class="n">lambda</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">t</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">;</span>
  <span class="n">U</span><span class="p">(</span><span class="n">theta</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">phi</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">t</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="quantum-teleportation">
<h3>Quantum teleportation<a class="headerlink" href="#quantum-teleportation" title="Permalink to this headline">¶</a></h3>
<p>Quantum teleportation
(Fig. <a class="reference external" href="#fig:example:teleport">[fig:example:teleport]</a>) demonstrates
conditional application of future gates based on prior measurement
outcomes.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// quantum teleportation example</span>
<span class="n">OPENQASM</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>
<span class="n">qubit</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="n">bit</span> <span class="n">c0</span><span class="p">;</span>
<span class="n">bit</span> <span class="n">c1</span><span class="p">;</span>
<span class="n">bit</span> <span class="n">c2</span><span class="p">;</span>
<span class="c1">// optional post-rotation for state tomography</span>
<span class="c1">// empty gate body =&gt; identity gate</span>
<span class="n">gate</span> <span class="n">post</span> <span class="n">q</span> <span class="p">{</span> <span class="p">}</span>
<span class="n">reset</span> <span class="n">q</span><span class="p">;</span>
<span class="n">u3</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">h</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">h</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">c0</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="n">c0</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">z</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="n">c1</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="n">x</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="p">}</span>  <span class="c1">// braces optional in this case</span>
<span class="n">post</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">c2</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="quantum-fourier-transform">
<h3>Quantum Fourier transform<a class="headerlink" href="#quantum-fourier-transform" title="Permalink to this headline">¶</a></h3>
<p>The quantum Fourier transform (QFT,
Fig. <a class="reference external" href="#fig:example:qft">[fig:example:qft]</a>) demonstrates parameter
passing to gate subroutines. This circuit applies the QFT to the state
<span class="math notranslate nohighlight">\(|q_0 q_1 q_2 q_3\rangle=|1010\rangle\)</span> and measures in the
computational basis.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// quantum Fourier transform</span>
<span class="n">OPENQASM</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>
<span class="n">qubit</span> <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="n">bit</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="n">reset</span> <span class="n">q</span><span class="p">;</span>
<span class="n">x</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">x</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">h</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">cphase</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">h</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">cphase</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">cphase</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">h</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">cphase</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">cphase</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">cphase</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">h</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">q</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="iterative-phase-estimation">
<h3>Iterative phase estimation<a class="headerlink" href="#iterative-phase-estimation" title="Permalink to this headline">¶</a></h3>
<p>We can extend the two prior examples to iterative phase estimation. This
example makes use of gate modifiers and fast-feedback.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>/*
 * Iterative phase estimation
 */
OPENQASM 3;
include &quot;stdgates.inc&quot;;

const n = 10;          // number of iterations
const theta = 3 * pi / 8;  // phase angle on target qubit

qubit q;    // phase estimation qubit
qubit r;    // target qubit for the controlled-unitary gate
angle[n] c; // phase estimation bits

// initialize
reset q;
reset r;

// prepare uniform superposition of eigenvectors of phase
h r;

// iterative phase estimation loop
uint[n] power = 1;
for i in [0: n - 1] {  // implicitly cast val to int
  reset q;
  h q;
  ctrl @ pow[power] @ phase(theta) q, r;
  inv @ phase(c) q;
  h q;
  measure q -&gt; c[0];
  // newest measurement outcome is associated to a pi/2 phase shift
  // in the next iteration, so shift all bits of c left
  c &lt;&lt;= 1;
  power &lt;&lt;= 1;
}

// Now c contains the n-bit estimate of phi in the
// eigenvalue e^{i*phi} and qreg r is projected to an
// approximate eigenstate of the phase gate.
</pre></div>
</div>
</div>
<div class="section" id="ripple-carry-adder">
<h3>Ripple-carry adder<a class="headerlink" href="#ripple-carry-adder" title="Permalink to this headline">¶</a></h3>
<p>The ripple-carry adder <a class="bibtex reference internal" href="#cuccaro04" id="id1">[CDKM04]</a> shown in
Fig. <a class="reference external" href="#fig:example:add">[fig:example:add]</a> exhibits hierarchical use
of gate subroutines.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * quantum ripple-carry adder</span>
<span class="cm"> * Cuccaro et al, quant-ph/0410184</span>
<span class="cm"> */</span>
<span class="n">OPENQASM</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>

<span class="n">gate</span> <span class="n">majority</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">{</span>
    <span class="n">cx</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">cx</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">ccx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">gate</span> <span class="n">unmaj</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">{</span>
    <span class="n">ccx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
    <span class="n">cx</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">;</span>
    <span class="n">cx</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">qubit</span> <span class="n">cin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">cout</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">bit</span> <span class="n">ans</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="n">uint</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">a_in</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// a = 0001</span>
<span class="n">uint</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">b_in</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="c1">// b = 1111</span>
<span class="c1">// initialize qubits</span>
<span class="n">reset</span> <span class="n">cin</span><span class="p">;</span>
<span class="n">reset</span> <span class="n">a</span><span class="p">;</span>
<span class="n">reset</span> <span class="n">b</span><span class="p">;</span>
<span class="n">reset</span> <span class="n">cout</span><span class="p">;</span>

<span class="c1">// set input states</span>
<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span> <span class="mi">3</span><span class="p">]</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="kt">bool</span><span class="p">(</span><span class="n">ain</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="n">x</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="k">if</span><span class="p">(</span><span class="kt">bool</span><span class="p">(</span><span class="n">bin</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="n">x</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>
<span class="c1">// add a to b, storing result in b</span>
<span class="n">majority</span> <span class="n">cin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span> <span class="mi">2</span><span class="p">]</span> <span class="p">{</span> <span class="n">majority</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="p">}</span>
<span class="n">cx</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">cout</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">[</span><span class="mi">2</span><span class="o">:</span> <span class="mi">-1</span><span class="o">:</span> <span class="mi">0</span><span class="p">]</span> <span class="p">{</span> <span class="n">unmaj</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span> <span class="p">}</span>
<span class="n">unmaj</span> <span class="n">cin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">measure</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">ans</span><span class="p">[</span><span class="mi">0</span><span class="o">:</span><span class="mi">3</span><span class="p">];</span>
<span class="n">measure</span> <span class="n">cout</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">ans</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="randomized-benchmarking">
<h3>Randomized benchmarking<a class="headerlink" href="#randomized-benchmarking" title="Permalink to this headline">¶</a></h3>
<p>A complete randomized benchmarking experiment could be described by a
high level program. After passing through the upper phases of
compilation, the program consists of many quantum circuits and
associated classical control. Benchmarking is a particularly simple
example because there is no data dependence between these quantum
circuits.</p>
<p>Each circuit is a sequence of random Clifford gates composed from a set
of basic gates (Fig. <a class="reference external" href="#fig:example:rb">[fig:example:rb]</a> uses the
gate set , , , and Paulis). If the gate set differs from the built-in
gate set, new gates can be defined using the statement. Each of the
randomly-chosen Clifford gates is separated from prior and future gates
by barrier instructions to prevent the sequence from simplifying to the
identity as a result of subsequent transformations.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// One randomized benchmarking sequence</span>
<span class="n">OPENQASM</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>

<span class="n">qubit</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">bit</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

<span class="n">reset</span> <span class="n">q</span><span class="p">;</span>
<span class="n">h</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">cz</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">s</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">cz</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">s</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">z</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">h</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">measure</span> <span class="n">q</span> <span class="o">-&gt;</span> <span class="n">c</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="quantum-process-tomography">
<h3>Quantum process tomography<a class="headerlink" href="#quantum-process-tomography" title="Permalink to this headline">¶</a></h3>
<p>As in randomized benchmarking, a high-level program describes a quantum
process tomography (QPT) experiment. Each program compiles to
intermediate code with several independent quantum circuits that can
each be described using OpenQASM (version 2.0).
Fig. <a class="reference external" href="#fig:example:qpt">[fig:example:qpt]</a> shows QPT of a Hadamard
gate. Each circuit is identical except for the definitions of the and
gates. The empty definitions in the current example are placeholders
that define identity gates. For textbook QPT, the and gates are both
taken from the set <span class="math notranslate nohighlight">\(\{I,H,SH\}\)</span> to prepare <span class="math notranslate nohighlight">\(|0\rangle\)</span>,
<span class="math notranslate nohighlight">\(|+\rangle\)</span>, and <span class="math notranslate nohighlight">\(|+i\rangle\)</span> and measure in the <span class="math notranslate nohighlight">\(Z\)</span>,
<span class="math notranslate nohighlight">\(X\)</span>, and <span class="math notranslate nohighlight">\(Y\)</span> basis.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">OPENQASM</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>

<span class="n">gate</span> <span class="n">pre</span> <span class="n">q</span> <span class="p">{</span> <span class="p">}</span>   <span class="c1">// pre-rotation</span>
<span class="n">gate</span> <span class="n">post</span> <span class="n">q</span> <span class="p">{</span> <span class="p">}</span>  <span class="c1">// post-rotation</span>

<span class="n">qubit</span> <span class="n">q</span><span class="p">;</span>
<span class="n">bit</span> <span class="n">c</span><span class="p">;</span>
<span class="n">reset</span> <span class="n">q</span><span class="p">;</span>
<span class="n">pre</span> <span class="n">q</span><span class="p">;</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">h</span> <span class="n">q</span><span class="p">;</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">post</span> <span class="n">q</span><span class="p">;</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">q</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="basic-quantum-error-correction">
<h3>Basic quantum error-correction<a class="headerlink" href="#basic-quantum-error-correction" title="Permalink to this headline">¶</a></h3>
<p>This example of the 3-bit quantum repetition code
(Fig. <a class="reference external" href="#fig:example:qec3">[fig:example:qec3]</a>) demonstrates how
OpenQASM (version 3.0) can express simple quantum error-correction
circuits.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// Repetition code syndrome measurement</span>
<span class="n">OPENQASM</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>

<span class="n">qubit</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="n">qubit</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">bit</span> <span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="n">bit</span> <span class="n">syn</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

<span class="n">def</span> <span class="n">syndrome</span> <span class="n">qubit</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">:</span><span class="n">d</span><span class="p">,</span> <span class="n">qubit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">:</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">bit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">{</span>
  <span class="n">bit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">cx</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="n">cx</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="n">cx</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="n">cx</span> <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="n">measure</span> <span class="n">a</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">reset</span> <span class="n">q</span><span class="p">;</span>
<span class="n">reset</span> <span class="n">a</span><span class="p">;</span>
<span class="n">x</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// insert an error</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">syn</span> <span class="o">=</span> <span class="n">syndrome</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">;</span>
<span class="c1">// also valid: syndrome q, a -&gt; syn;</span>
<span class="k">if</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">syn</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">x</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">syn</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="n">x</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">syn</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="n">x</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">q</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="surface-code-error-correction">
<h3>Surface code error-correction<a class="headerlink" href="#surface-code-error-correction" title="Permalink to this headline">¶</a></h3>
<p>The surface code is one of the leading approaches to fault-tolerant
quantum computing. This example implements a fault-tolerant surface code
quantum memory with calls to kernel functions for logging and processing
the measurement data. These kernel functions must run concurrently with
quantum gates and may not have a deterministic running time (cite).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Surface code quantum memory.</span>
<span class="cm"> *</span>
<span class="cm"> * Estimate the failure probability as a function</span>
<span class="cm"> * of parameters at the top of the file.</span>
<span class="cm"> */</span>
<span class="n">OPENQASM</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>

<span class="k">const</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>         <span class="c1">// code distance</span>
<span class="k">const</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>        <span class="c1">// number of syndrome measurement cycles</span>
<span class="k">const</span> <span class="n">shots</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>  <span class="c1">// number of samples</span>
<span class="k">const</span> <span class="n">n</span> <span class="o">=</span> <span class="n">d</span><span class="o">^</span><span class="mi">2</span><span class="p">;</span>       <span class="c1">// number of code qubits</span>

<span class="n">uint</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">failures</span><span class="p">;</span>  <span class="c1">// number of observed failures</span>

<span class="n">kernel</span> <span class="n">zfirst</span> <span class="n">creg</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">;</span>
<span class="n">kernel</span> <span class="n">send</span> <span class="n">creg</span><span class="p">[</span><span class="n">n</span> <span class="mi">-1</span> <span class="p">],</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">;</span>
<span class="n">kernel</span> <span class="n">zlast</span> <span class="n">creg</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span> <span class="o">-&gt;</span> <span class="n">bit</span><span class="p">;</span>

<span class="n">qubit</span> <span class="n">data</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>  <span class="c1">// code qubits</span>
<span class="n">qubit</span> <span class="n">ancilla</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>  <span class="c1">// syndrome qubits</span>
<span class="cm">/*</span>
<span class="cm"> * Ancilla are addressed in a (d-1) by (d-1) square array</span>
<span class="cm"> * followed by 4 length (d-1)/2 arrays for the top,</span>
<span class="cm"> * bottom, left, and right boundaries.</span>
<span class="cm"> */</span>

<span class="n">bit</span> <span class="n">layer</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>  <span class="c1">// syndrome outcomes in a cycle</span>
<span class="n">bit</span> <span class="n">data_outcomes</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>  <span class="c1">// data outcomes at the end</span>
<span class="n">bit</span> <span class="n">outcome</span><span class="p">;</span>  <span class="c1">// logical outcome</span>

<span class="cm">/* Declare a sub-circuit for Hadamard gates on ancillas</span>
<span class="cm"> */</span>
<span class="n">def</span> <span class="n">hadamard_layer</span> <span class="n">qubit</span><span class="p">[</span><span class="n">n</span><span class="mi">-1</span><span class="p">]</span><span class="o">:</span><span class="n">ancilla</span> <span class="p">{</span>
  <span class="c1">// Hadamards in the bulk</span>
  <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span> <span class="n">d</span><span class="mi">-2</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">col</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span> <span class="n">d</span><span class="mi">-2</span><span class="p">]</span> <span class="p">{</span>
      <span class="n">bit</span> <span class="n">sum</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="n">bit</span><span class="p">[</span><span class="mi">32</span><span class="p">](</span><span class="n">row</span> <span class="o">+</span> <span class="n">col</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">sum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">h</span> <span class="n">ancilla</span><span class="p">[</span><span class="n">row</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">col</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// Hadamards on the left and right boundaries</span>
  <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="p">{</span>
    <span class="n">h</span> <span class="n">ancilla</span><span class="p">[(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Declare a sub-circuit for a syndrome cycle.</span>
<span class="cm"> */</span>
<span class="n">def</span> <span class="n">cycle</span> <span class="n">qubit</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">:</span><span class="n">data</span><span class="p">,</span> <span class="n">qubit</span><span class="p">[</span><span class="n">n</span><span class="mi">-1</span><span class="p">]</span><span class="o">:</span><span class="n">ancilla</span> <span class="o">-&gt;</span> <span class="n">bit</span><span class="p">[</span><span class="n">n</span><span class="mi">-1</span><span class="p">]</span> <span class="p">{</span>
  <span class="n">reset</span> <span class="n">ancilla</span><span class="p">;</span>
  <span class="n">hadamard_layer</span> <span class="n">ancilla</span><span class="p">;</span>

  <span class="c1">// First round of CNOTs in the bulk</span>
  <span class="k">for</span> <span class="n">row</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">col</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span><span class="n">d</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="p">{</span>
      <span class="n">bit</span> <span class="n">sum</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">=</span> <span class="n">bit</span><span class="p">[</span><span class="mi">32</span><span class="p">](</span><span class="n">row</span> <span class="o">+</span> <span class="n">col</span><span class="p">);</span>
      <span class="k">if</span><span class="p">(</span><span class="n">sum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">cx</span> <span class="n">data</span><span class="p">[</span><span class="n">row</span> <span class="o">*</span> <span class="n">d</span> <span class="o">+</span> <span class="n">col</span><span class="p">],</span> <span class="n">ancilla</span><span class="p">[</span><span class="n">row</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">col</span><span class="p">];</span>
      <span class="k">if</span><span class="p">(</span><span class="n">sum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cx</span> <span class="n">ancilla</span><span class="p">[</span><span class="n">row</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">col</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">row</span> <span class="o">*</span> <span class="n">d</span> <span class="o">+</span> <span class="n">col</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="c1">// First round of CNOTs on the bottom boundary</span>
  <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="p">{</span>
    <span class="n">cx</span> <span class="n">data</span><span class="p">[</span><span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">],</span> <span class="n">ancilla</span><span class="p">[(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span> <span class="n">d</span><span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="c1">// First round of CNOTs on the right boundary</span>
  <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span><span class="o">:</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="p">{</span>
    <span class="n">cx</span> <span class="n">ancilla</span><span class="p">[(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">^</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">i</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="c1">// Remaining rounds of CNOTs, go here ...</span>

  <span class="n">hadamard_layer</span> <span class="n">ancilla</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">measure</span> <span class="n">ancilla</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Loop over shots</span>
<span class="k">for</span> <span class="n">shot</span> <span class="n">in</span> <span class="p">[</span><span class="mi">1</span><span class="o">:</span> <span class="n">shots</span><span class="p">]</span> <span class="p">{</span>

  <span class="c1">// Initialize</span>
  <span class="n">reset</span> <span class="n">data</span><span class="p">;</span>
  <span class="n">cycle</span> <span class="n">data</span><span class="p">,</span> <span class="n">ancilla</span> <span class="o">-&gt;</span> <span class="n">layer</span><span class="p">;</span>
  <span class="n">zfirst</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">shot</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>

  <span class="c1">// m cycles of syndrome measurement</span>
  <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">[</span><span class="mi">1</span><span class="o">:</span> <span class="n">m</span><span class="p">]</span> <span class="p">{</span>
    <span class="n">cycle</span> <span class="n">data</span><span class="p">,</span> <span class="n">ancilla</span> <span class="o">-&gt;</span> <span class="n">layer</span><span class="p">;</span>
    <span class="n">send</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">shot</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Measure</span>
  <span class="n">data_outcomes</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">data</span><span class="p">;</span>

  <span class="n">outcome</span> <span class="o">=</span> <span class="n">zlast</span><span class="p">(</span><span class="n">data_outcomes</span><span class="p">,</span> <span class="n">shot</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
  <span class="n">failures</span> <span class="o">+=</span> <span class="kt">int</span><span class="p">(</span><span class="n">outcome</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* The ratio of &quot;failures&quot; to &quot;shots&quot; is our result.</span>
<span class="cm"> * The data can be logged by the external functions too.</span>
<span class="cm"> */</span>
</pre></div>
</div>
</div>
<div class="section" id="repeat-until-success-circuits">
<h3>Repeat-until-success circuits<a class="headerlink" href="#repeat-until-success-circuits" title="Permalink to this headline">¶</a></h3>
<p>The while loop allows implementation of repeat-until-success circuits
that have a non-deterministic number of iterations but complete in a
very small number of iterations with high probability. This example from
<a class="bibtex reference internal" href="#nc00" id="id2">[NC00]</a> applies a Z-rotation by an irrational angle
using a discrete universal gate set.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Repeat-until-success circuit for Rz(theta),</span>
<span class="cm"> * cos(theta-pi)=3/5, from Nielsen and Chuang, Chapter 4.</span>
<span class="cm"> */</span>
<span class="n">OPENQASM</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Applies identity if out is 01, 10, or 11 and a Z-rotation by</span>
<span class="cm"> * theta + pi where cos(theta)=3/5 if out is 00.</span>
<span class="cm"> * The 00 outcome occurs with probability 5/8.</span>
<span class="cm"> */</span>
<span class="n">def</span> <span class="n">segment</span> <span class="n">qubit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">:</span><span class="n">anc</span><span class="p">,</span> <span class="nl">qubit</span><span class="p">:</span><span class="n">psi</span> <span class="o">-&gt;</span> <span class="n">bit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">{</span>
  <span class="n">bit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">b</span><span class="p">;</span>
  <span class="n">reset</span> <span class="n">anc</span><span class="p">;</span>
  <span class="n">h</span> <span class="n">anc</span><span class="p">;</span>
  <span class="n">ccx</span> <span class="n">anc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">anc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">psi</span><span class="p">;</span>
  <span class="n">s</span> <span class="n">psi</span><span class="p">;</span>
  <span class="n">ccx</span> <span class="n">anc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">anc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">psi</span><span class="p">;</span>
  <span class="n">z</span> <span class="n">psi</span><span class="p">;</span>
  <span class="n">h</span> <span class="n">anc</span><span class="p">;</span>
  <span class="n">measure</span> <span class="n">anc</span> <span class="o">-&gt;</span> <span class="n">b</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">qubit</span> <span class="n">input</span><span class="p">;</span>
<span class="n">qubit</span> <span class="n">ancilla</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">bit</span> <span class="n">flags</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;11&quot;</span><span class="p">;</span>
<span class="n">bit</span> <span class="n">output</span><span class="p">;</span>

<span class="n">reset</span> <span class="n">input</span><span class="p">;</span>
<span class="n">h</span> <span class="n">input</span><span class="p">;</span>

<span class="c1">// braces are optional in this case</span>
<span class="k">while</span><span class="p">(</span><span class="kt">int</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">flags</span> <span class="o">=</span> <span class="n">segment</span> <span class="n">ancilla</span><span class="p">,</span> <span class="n">input</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">rz</span><span class="p">(</span><span class="n">pi</span> <span class="o">-</span> <span class="n">arccos</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">5</span><span class="p">))</span> <span class="n">input</span><span class="p">;</span>
<span class="n">h</span> <span class="n">input</span><span class="p">;</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">measure</span> <span class="n">input</span><span class="p">;</span>  <span class="c1">// should get zero</span>
</pre></div>
</div>
</div>
<div class="section" id="relaxation-characterization">
<h3>Relaxation characterization<a class="headerlink" href="#relaxation-characterization" title="Permalink to this headline">¶</a></h3>
<p>Qubit relaxation is the rate at which a qubit goes from an excited state
towards the ground state. This is an exponential rate denoted as T1. The
experiment to characterize this requires a circuit with multiple simple
basic blocks, where each is a sequence of reset, excitation, delay and
measurement. The delays in this example are given in fixed intervals in
SI units. Here we do the tabulation via a kernel function. However,
there are other post-processing steps associated with this experiment,
namely fitting the T1 exponential decay curve. This happens in the
runtime environment of this experiment, and not on the controllers.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* Measuring the relaxation time of a qubit</span>
<span class="cm"> * This example demonstrates the repeated use of fixed delays.</span>
<span class="cm">*/</span>
<span class="n">OPENQASM</span> <span class="mf">3.0</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>

<span class="n">length</span> <span class="n">stride</span> <span class="o">=</span> <span class="mi">1u</span><span class="n">s</span><span class="p">;</span>            <span class="c1">// time resolution of points taken</span>
<span class="k">const</span> <span class="n">points</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>              <span class="c1">// number of points taken</span>
<span class="k">const</span> <span class="n">shots</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>             <span class="c1">// how many shots per point</span>

<span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">counts0</span><span class="p">,</span> <span class="n">counts1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>   <span class="c1">// surviving |1&gt; populations of qubits</span>

<span class="n">kernel</span> <span class="nf">tabulate</span><span class="p">(</span><span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">counts</span><span class="p">,</span> <span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">shots</span><span class="p">,</span> <span class="kt">int</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span><span class="o">:</span><span class="n">num</span><span class="p">);</span>

<span class="n">cbit</span> <span class="n">c0</span><span class="p">,</span> <span class="n">c1</span><span class="p">;</span>

<span class="c1">// define a gate calibration for an X gate on qubit 1</span>
<span class="n">defcal</span> <span class="s">&quot;openpulse&quot;</span> <span class="n">x</span> <span class="o">%</span><span class="mi">0</span> <span class="p">{</span>
   <span class="n">play</span> <span class="nf">drive</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span><span class="p">),</span> <span class="n">gaussian</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">p</span> <span class="n">in</span> <span class="p">[</span><span class="mi">0</span> <span class="o">:</span> <span class="n">points</span><span class="mi">-1</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="p">[</span><span class="mi">1</span> <span class="o">:</span> <span class="n">shots</span><span class="p">]</span> <span class="p">{</span>
        <span class="c1">// start of a basic block</span>
        <span class="n">reset</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">reset</span> <span class="o">%</span><span class="mi">1</span><span class="p">;</span>
        <span class="c1">// excite qubits</span>
        <span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">x</span> <span class="o">%</span><span class="mi">1</span><span class="p">;</span>
        <span class="c1">// wait for a fixed time indicated by loop counter</span>
        <span class="n">delay</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">stride</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
        <span class="c1">// wait for a fixed time indicated by loop counters</span>
        <span class="n">delay</span><span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="n">lengthof</span><span class="p">({</span><span class="n">x</span> <span class="o">%</span><span class="mi">1</span><span class="p">;})];</span>
        <span class="c1">// read out qubit states</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">measure</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">measure</span> <span class="o">%</span><span class="mi">1</span><span class="p">;</span>
        <span class="c1">// increment counts memories, if a 1 is seen</span>
        <span class="n">counts0</span> <span class="o">+=</span> <span class="kt">int</span><span class="p">(</span><span class="n">c0</span><span class="p">);</span>
        <span class="n">counts1</span> <span class="o">+=</span> <span class="kt">int</span><span class="p">(</span><span class="n">c1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// log survival probability curve</span>
    <span class="n">tabulate</span><span class="p">(</span><span class="n">counts0</span><span class="p">,</span> <span class="n">shots</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
    <span class="n">tabulate</span><span class="p">(</span><span class="n">counts1</span><span class="p">,</span> <span class="n">shots</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="time-alignment">
<h3>Time alignment<a class="headerlink" href="#time-alignment" title="Permalink to this headline">¶</a></h3>
<p>Flexible alignment of gates can be achieved using stretch, even on
virtual qubits.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* CPMG XY4 decoupling</span>
<span class="cm"> * This example demonstrates the use of stretch to</span>
<span class="cm"> * specify design intent on gate alignment, without</span>
<span class="cm"> * being tied to physical qubits and gates.</span>
<span class="cm">*/</span>
<span class="n">OPENQASM</span> <span class="mf">3.0</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>

<span class="n">stretch</span> <span class="n">g</span><span class="p">;</span>

<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
<span class="n">cx</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="n">delay</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">U</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">delay</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">g</span><span class="p">]</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="n">barrier</span> <span class="n">q</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="dynamical-decoupling">
<h3>Dynamical decoupling<a class="headerlink" href="#dynamical-decoupling" title="Permalink to this headline">¶</a></h3>
<p>Dynamical decoupling is a technique for mitigating decoherence by
alternating the direction of phase accumulation during a qubit’s idle
time. Timing has a high impact on the quality of the DD sequence. Here
we show an example of a CPMG-type DD where the rotations are about the X
and Y axis. The X and Y gates themselves have finite duration, and we
seek to time them such that their <em>centers</em> are equidistant in time. We
use negative lengths and stretch to accomplish this. This sequence is
defined on a generic qubit, not necessarily a physical one. Our use of
stretch makes the delays adjust as appropriate whenever a concrete qubit
is targetted.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* CPMG XY4 decoupling</span>
<span class="cm"> * This example demonstrates the use of referential delays</span>
<span class="cm"> * and time alignment.</span>
<span class="cm">*/</span>
<span class="n">OPENQASM</span> <span class="mf">3.0</span><span class="p">;</span>
<span class="n">include</span> <span class="s">&quot;stdgates.inc&quot;</span><span class="p">;</span>

<span class="n">length</span> <span class="n">start_stretch</span> <span class="o">=</span> <span class="mf">-0.5</span> <span class="o">*</span> <span class="n">lengthof</span><span class="p">({</span><span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;})</span> <span class="o">+</span> <span class="n">stretch</span>
<span class="n">length</span> <span class="n">middle_stretch</span> <span class="o">=</span> <span class="mf">-0.5</span> <span class="o">*</span> <span class="n">lengthof</span><span class="p">({</span><span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;})</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">lengthof</span><span class="p">({</span><span class="n">y</span> <span class="o">%</span><span class="mi">0</span><span class="p">;}</span> <span class="o">+</span> <span class="n">stretch</span>
<span class="n">length</span> <span class="n">end_stretch</span> <span class="o">=</span> <span class="mf">-0.5</span> <span class="o">*</span> <span class="n">lengthof</span><span class="p">({</span><span class="n">y</span> <span class="o">%</span><span class="mi">0</span><span class="p">;})</span> <span class="o">+</span> <span class="n">stretch</span>

<span class="n">box</span> <span class="p">{</span>
  <span class="n">delay</span><span class="p">[</span><span class="n">start_stretch</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">delay</span><span class="p">[</span><span class="n">middle_stretch</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">y</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">delay</span><span class="p">[</span><span class="n">middle_stretch</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">delay</span><span class="p">[</span><span class="n">middle_stretch</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">y</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">delay</span><span class="p">[</span><span class="n">end_stretch</span><span class="p">]</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>

  <span class="n">cx</span> <span class="o">%</span><span class="mi">2</span><span class="p">,</span> <span class="o">%</span><span class="mi">3</span><span class="p">;</span>
  <span class="n">cx</span> <span class="o">%</span><span class="mi">1</span><span class="p">,</span> <span class="o">%</span><span class="mi">2</span><span class="p">;</span>
  <span class="n">u</span> <span class="o">%</span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="pulse-declarations">
<h3>Pulse declarations<a class="headerlink" href="#pulse-declarations" title="Permalink to this headline">¶</a></h3>
<p>A notional example of a possible “openpulse” grammar for use within
blocks is shown below. The particular example is sufficient to describe
a typical implementation of with cross-resonance gates, where the
implementation consists of an echo sequence and a lower-level primitive.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">defcalgrammar</span> <span class="s">&quot;openpulse&quot;</span><span class="p">;</span>

<span class="n">defcal</span> <span class="n">x</span> <span class="o">%</span><span class="mi">0</span> <span class="p">{</span>
   <span class="n">play</span> <span class="nf">drive</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span><span class="p">),</span> <span class="n">gaussian</span><span class="p">(...);</span>
<span class="p">}</span>

<span class="n">defcal</span> <span class="n">x</span> <span class="o">%</span><span class="mi">1</span> <span class="p">{</span>
  <span class="n">play</span> <span class="nf">drive</span><span class="p">(</span><span class="o">%</span><span class="mi">1</span><span class="p">),</span> <span class="n">gaussian</span><span class="p">(...);</span>
<span class="p">}</span>

<span class="n">defcal</span> <span class="n">rz</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">:</span><span class="n">theta</span><span class="p">)</span> <span class="o">%</span><span class="n">q</span> <span class="p">{</span>
  <span class="n">shift_phase</span> <span class="nf">drive</span><span class="p">(</span><span class="o">%</span><span class="n">q</span><span class="p">),</span> <span class="o">-</span><span class="n">theta</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">defcal</span> <span class="n">measure</span> <span class="o">%</span><span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">bit</span> <span class="p">{</span>
  <span class="k">complex</span><span class="p">[</span><span class="kt">int</span><span class="p">[</span><span class="mi">24</span><span class="p">]]</span> <span class="n">iq</span><span class="p">;</span>
  <span class="n">bit</span> <span class="n">state</span><span class="p">;</span>
  <span class="k">complex</span><span class="p">[</span><span class="kt">int</span><span class="p">[</span><span class="mi">12</span><span class="p">]]</span> <span class="n">k0</span><span class="p">[</span><span class="mi">1024</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i0</span> <span class="o">+</span> <span class="n">q0</span><span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="n">i1</span> <span class="o">+</span> <span class="n">q1</span><span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="n">i2</span> <span class="o">+</span> <span class="n">q2</span><span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="p">...];</span>
  <span class="n">play</span> <span class="nf">measure</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span><span class="p">),</span> <span class="n">flat_top_gaussian</span><span class="p">(...);</span>
  <span class="n">iq</span> <span class="o">=</span> <span class="n">capture</span> <span class="n">acquire</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span><span class="p">),</span> <span class="mi">2048</span><span class="p">,</span> <span class="n">kernel</span><span class="p">(</span><span class="n">k0</span><span class="p">);</span>
  <span class="k">return</span> <span class="nf">threshold</span><span class="p">(</span><span class="n">iq</span><span class="p">,</span> <span class="mi">1234</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">defcal</span> <span class="n">zx90_ix</span> <span class="o">%</span><span class="mi">0</span><span class="p">,</span> <span class="o">%</span><span class="mi">1</span> <span class="p">{</span>
  <span class="n">play</span> <span class="nf">drive</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;cr1&quot;</span><span class="p">),</span> <span class="n">flat_top_gaussian</span><span class="p">(...);</span>  <span class="c1">// uses a non-default</span>
                                                  <span class="c1">// frame labeled &quot;cr1&quot;</span>
<span class="p">}</span>

<span class="n">defcal</span> <span class="n">cx</span> <span class="o">%</span><span class="mi">0</span><span class="p">,</span> <span class="o">%</span><span class="mi">1</span> <span class="p">{</span>
  <span class="n">zx90_ix</span> <span class="o">%</span><span class="mi">0</span><span class="p">,</span> <span class="o">%</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">shift_phase</span> <span class="nf">drive</span><span class="p">(</span><span class="o">%</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;cr1&quot;</span><span class="p">);</span>
  <span class="n">zx90_ix</span> <span class="o">%</span><span class="mi">0</span><span class="p">,</span> <span class="o">%</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">x</span> <span class="o">%</span><span class="mi">0</span><span class="p">;</span>
  <span class="n">x</span> <span class="o">%</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="bibliography">
<h1>Bibliography<a class="headerlink" href="#bibliography" title="Permalink to this headline">¶</a></h1>
<p id="bibtex-bibliography-index-0"><dl class="citation">
<dt class="bibtex label" id="cuccaro04"><span class="brackets">CDKM04</span></dt>
<dd><p>S. Cuccaro, T. Draper, S. Kutin, and D. Moulton. A new quantum ripple-carry addition circuit. <em>arXiv:quant-ph/0410184</em>, 2004.</p>
</dd>
<dt class="bibtex label" id="nc00"><span class="brackets">NC00</span></dt>
<dd><p>M.A. Nielsen and I.L. Chuang. <em>Quantum Computation and Quantum Information</em>. Cambridge Univ. Press, 2000.</p>
</dd>
</dl>
</p>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">OpenQASM Live Specification</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-intro">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-language/index">Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-examples">Examples</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017-2020, Andrew W. Cross, Lev S. Bishop, John A. Smolin, Jay M. Gambetta.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>